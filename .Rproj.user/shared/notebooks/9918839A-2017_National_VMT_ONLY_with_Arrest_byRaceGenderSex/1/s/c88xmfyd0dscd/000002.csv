"0","get_column_colors <- function(table_of_data) {"
"0","  table_of_data %>%"
"0","    mutate("
"0","      crash_drivers_ratio = color_tile(""#deebf7"", ""#63aacf"")(crash_drivers_ratio),"
"0","      crash_vmt_ratio = color_tile(""#deebf7"", ""#63aacf"")(crash_vmt_ratio),"
"0","      arrest_driver_ratio = color_tile(""#deebf7"", ""#63aacf"")(arrest_driver_ratio),"
"0","      arrest_vmt_ratio = color_tile(""#deebf7"", ""#63aacf"")(arrest_vmt_ratio)"
"0","    )"
"0","}"
"0",""
"0","get_data_of_percents_and_ratios_for_table <-"
"0","  function(summarized_data,"
"0","           fields_that_were_summarised) {"
"0","      round_to_0_digits <-"
"0","      c(""nhts_n"","
"0","        ""total_drivers"","
"0","        ""crash_count"","
"0","        ""total_arrests"","
"0","        ""total_population"")"
"0","    round_to_2_digits <-"
"0","      c("
"0","        ""total_vmt"","
"0","        ""percent_of_crashes"","
"0","        ""percent_of_drivers"","
"0","        ""percent_of_vmt"","
"0","        ""percent_of_arrests"","
"0","        # ""percent_of_arrests_by_pop"","
"0","        ""percent_of_population"","
"0","        ""crash_drivers_ratio"","
"0","        ""crash_vmt_ratio"","
"0","        # ""arrest_pop_ratio"","
"0","        ""arrest_driver_ratio"","
"0","        ""arrest_vmt_ratio"""
"0","      )"
"0","    total_these_variables <-"
"0","      c("
"0","        ""nhts_n"","
"0","        ""total_drivers"","
"0","        ""crash_count"","
"0","        ""total_arrests"","
"0","        ""total_population"","
"0","        ""total_vmt"","
"0","        ""percent_of_crashes"","
"0","        ""percent_of_drivers"","
"0","        ""percent_of_vmt"","
"0","        ""percent_of_arrests"","
"0","        ""percent_of_population"""
"0","        # ""percent_of_arrests_by_pop"""
"0","      )"
"0","    data <- summarized_data %>%"
"0","      select("
"0","        dplyr::all_of(fields_that_were_summarised),"
"0","        nhts_n,"
"0","        total_drivers,"
"0","        PMD,"
"0","        crash_count,"
"0","        total_arrests,"
"0","        total_population"
"0","      ) %>%"
"0","      mutate("
"0","        total_vmt = (total_drivers * PMD) / 1000000000,"
"0","        percent_of_crashes = crash_count * 100 / sum(crash_count, na.rm = TRUE),"
"0","        percent_of_drivers = total_drivers * 100  / sum(total_drivers, na.rm = TRUE),"
"0","        percent_of_vmt = total_vmt * 100 / sum(total_vmt, na.rm = TRUE),"
"0","        percent_of_arrests = total_arrests * 100 / sum(total_arrests, na.rm = TRUE),"
"0","        percent_of_population = total_population * 100 / sum(total_population, na.rm = TRUE),"
"0","        # percent_of_arrests_by_pop = total_arrests* total_population / sum(total_population),"
"0","        # percent_of_arrests_by_pop = (total_population * total_arrests) * 100 / sum(total_population * total_arrests, na.rm = TRUE),"
"0","        crash_drivers_ratio = percent_of_crashes / percent_of_drivers,"
"0","        crash_vmt_ratio = percent_of_crashes / percent_of_vmt,"
"0","        # arrest_pop_ratio =  percent_of_arrests / percent_of_population,"
"0","        arrest_driver_ratio =  percent_of_arrests / percent_of_drivers,"
"0","        arrest_vmt_ratio = percent_of_arrests / percent_of_vmt,"
"0","        PMD = format(round(PMD, 0), big.mark = "","", scientific = FALSE)"
"0","      ) %>%"
"0","      mutate_at(round_to_0_digits,         # Rounds these fields"
"0","                round,"
"0","                digits = 0) %>%"
"0","      "
"0","      mutate_at(round_to_2_digits,         # Rounds these fields"
"0","                round,"
"0","                digits = 2) %>%"
"0","        # Adds columns to some colors"
"0","      adorn_totals(# Columns to TOTAL"
"0","        ""row"","
"0","        .... = total_these_variables, na.rm = TRUE)"
"0","    data[data == Inf] <- 0"
"0","    data"
"0","  }"
"0",""
"0","make_summarized_data_table <- function(data_to_make_table, name_of_fields_that_were_summarised, caption){"
"0","  # Number of table heading must match number of columns in the table"
"0","  table_headings = c("
"0","      paste0(name_of_fields_that_were_summarised),"
"0","      paste0(""Sample size (n)"", footnote_marker_number(1)),"
"0","      paste0(""Drivers"", footnote_marker_number(1)),"
"0","      paste0(""Average PMD"", footnote_marker_number(1)), #, footnote_marker_alphabet(1)"
"0","      paste0(""Drivers in a crash"", footnote_marker_number(2)),"
"0","      paste0(""Average annual OWI arrests"", footnote_marker_number(3)),"
"0","      paste0(""Population"", footnote_marker_number(4)),"
"0","      ""Annual VMT (100 million)"","
"0","      ""Share of drivers in a crash"","
"0","      ""Share of drivers"","
"0","      ""Share of VMT"","
"0","      ""Share of arrests"","
"0","      ""Share of population"","
"0","      # ""Share of arrests by weighted population"","
"0","      ""Ratio of crash to drivers"","
"0","      ""Ratio of crash to VMT"","
"0","      ""Ratio of arrests to drivers"","
"0","      ""Ratio of arrests to VMT"""
"0","    )"
"0","  total_row_number = which(data_to_make_table == ""Total"") # Find total row to bold"
"0","  data_to_make_table %>% "
"0","  kbl("
"0","    caption = caption,"
"0","    col.names = table_headings,"
"0","    format.args = list(big.mark = ','),  # Format - add a comma to all numbers"
"0","    escape = F"
"0","  ) %>%"
"0","  kable_styling(bootstrap_options = c(""striped"", ""hover"", ""condensed"")) %>%"
"0","  kable_classic(full_width = T, html_font = ""Cambria"") %>% row_spec(total_row_number, bold = T) %>% # Total row format"
"0","  # column_spec(7, width  = ""6em"") %>%"
"0","  # column_spec(8, width  = ""5em"") %>%"
"0","  # column_spec(16, color = ""white"") %>%"
"0","  footnote("
"0","    general = ""Average PMD is derived by taking driving data in four neighboring states (IA, IL, MI, MN, WI). VMT is derived by multplying PMD by total drivers."","
"0","    number = c(""Source: 2017 National Household Travel Survey\n"", ""Source: 2017 and 2018 Crash Database from TOPS Lab\n"", ""Source: 2017 and 2018 Arrest data from Wisconsin Department of Justice\n"", ""Source: 2017 Census Bureau Population Estimates Program\n""),"
"0","    footnote_as_chunk = T"
"0","  )"
"0","}"
